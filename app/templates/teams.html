{% extends "glass_base.html" %}

{% block title %}Teams - TaskFlow{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Teams Header -->
    <div class="glass-card mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">
                    <i class="bi bi-people text-primary"></i> Teams & Collaboration
                </h1>
                <p style="color: var(--text-secondary); font-size: 1.125rem;">
                    Manage your team members and collaborative boards
                </p>
            </div>
            <div>
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-glass">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Team Members -->
            <div class="glass-card mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>
                        <i class="bi bi-people-fill"></i> Team Members ({{ team_members|length }})
                    </h3>
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-person-plus"></i> Invite Member
                    </button>
                </div>

                {% if team_members %}
                    <div class="row">
                        {% for member in team_members %}
                        <div class="col-md-6 mb-3">
                            <div class="member-card">
                                <div class="d-flex align-items-center">
                                    <img src="https://ui-avatars.com/api/?name={{ member.username }}&size=48&background=667eea&color=fff"
                                         alt="{{ member.username }}"
                                         class="member-avatar">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">{{ member.username }}</h6>
                                        <small class="text-muted">
                                            {% if member.is_admin %}
                                                <i class="bi bi-shield-check"></i> Administrator
                                            {% else %}
                                                <i class="bi bi-person"></i> Team Member
                                            {% endif %}
                                        </small>
                                        <div class="mt-1">
                                            <span class="badge" style="background: var(--primary-color); font-size: 0.7rem;">
                                                {{ member.tasks.count() }} tasks
                                            </span>
                                        </div>
                                    </div>
                                    <div class="member-actions">
                                        <button class="btn btn-glass btn-sm" onclick="showComingSoon()">
                                            <i class="bi bi-envelope"></i>
                                        </button>
                                        <button class="btn btn-glass btn-sm" onclick="showComingSoon()">
                                            <i class="bi bi-three-dots"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-people" style="font-size: 4rem; color: var(--text-muted);"></i>
                        <h5 class="mt-3">No Team Members Yet</h5>
                        <p class="text-muted">
                            Start collaborating by sharing boards with your team members.
                        </p>
                        <button class="btn btn-primary" onclick="showComingSoon()">
                            <i class="bi bi-person-plus"></i> Invite Your First Team Member
                        </button>
                    </div>
                {% endif %}
            </div>

            <!-- Shared Boards -->
            <div class="glass-card">
                <h3 class="mb-3">
                    <i class="bi bi-kanban"></i> Collaborative Boards
                </h3>

                {% if user_boards %}
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Board Name</th>
                                    <th>Owner</th>
                                    <th>Members</th>
                                    <th>Tasks</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for board in user_boards %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-kanban me-2"></i>
                                            <div>
                                                <div class="fw-bold">{{ board.name }}</div>
                                                <small class="text-muted">{{ board.description or 'No description' }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="https://ui-avatars.com/api/?name={{ board.owner.username }}&size=24&background=667eea&color=fff"
                                                 alt="{{ board.owner.username }}"
                                                 class="rounded-circle me-2"
                                                 style="width: 24px; height: 24px;">
                                            {{ board.owner.username }}
                                            {% if board.owner_id == current_user.id %}
                                                <span class="badge bg-primary ms-1">You</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% set board_members = board.get_users_with_access() %}
                                            {% for member in board_members[:3] %}
                                                <img src="https://ui-avatars.com/api/?name={{ member.username }}&size=20&background=667eea&color=fff"
                                                     alt="{{ member.username }}"
                                                     class="rounded-circle"
                                                     style="width: 20px; height: 20px; margin-left: -5px;"
                                                     title="{{ member.username }}">
                                            {% endfor %}
                                            {% if board_members|length > 3 %}
                                                <span class="badge bg-secondary ms-1">+{{ board_members|length - 3 }}</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge" style="background: var(--primary-color);">
                                            {{ board.tasks.count() }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('tasks.list_tasks', board_id=board.id) }}" class="btn btn-glass btn-sm">
                                            <i class="bi bi-arrow-right"></i> View
                                        </a>
                                        {% if board.owner_id == current_user.id or current_user.is_admin %}
                                            <button class="btn btn-glass btn-sm" onclick="showComingSoon()">
                                                <i class="bi bi-gear"></i>
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-kanban" style="font-size: 2rem; color: var(--text-muted);"></i>
                        <p class="text-muted mt-2">No collaborative boards yet</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Team Stats -->
            <div class="glass-card mb-4">
                <h3 class="mb-3">
                    <i class="bi bi-graph-up"></i> Team Overview
                </h3>
                <div class="stat-item mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Team Members</span>
                        <span class="fw-bold" style="color: var(--primary-color);">{{ team_members|length }}</span>
                    </div>
                </div>
                <div class="stat-item mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Shared Boards</span>
                        <span class="fw-bold" style="color: var(--secondary-color);">{{ user_boards|length }}</span>
                    </div>
                </div>
                <div class="stat-item mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Boards You Own</span>
                        <span class="fw-bold" style="color: var(--accent-color);">{{ current_user.owned_boards.count() }}</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card mb-4">
                <h3 class="mb-3">
                    <i class="bi bi-lightning"></i> Quick Actions
                </h3>
                <div class="d-flex flex-column gap-2">
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-person-plus"></i> Invite Team Member
                    </button>
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-kanban"></i> Create Team Board
                    </button>
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-share"></i> Share Existing Board
                    </button>
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-envelope"></i> Send Team Message
                    </button>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="glass-card">
                <h3 class="mb-3">
                    <i class="bi bi-activity"></i> Recent Team Activity
                </h3>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-person-plus"></i>
                        </div>
                        <div class="activity-content">
                            <p class="mb-1">Team collaboration features</p>
                            <small class="text-muted">Coming soon in the next update</small>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-kanban"></i>
                        </div>
                        <div class="activity-content">
                            <p class="mb-1">Real-time board updates</p>
                            <small class="text-muted">Feature in development</small>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-chat"></i>
                        </div>
                        <div class="activity-content">
                            <p class="mb-1">Team messaging system</p>
                            <small class="text-muted">Planned for future release</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.member-card {
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 1px solid var(--glass-border);
    transition: all 0.3s ease;
}

.member-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.member-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    margin-right: 1rem;
}

.member-actions {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.stat-item {
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
}

.activity-feed {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.activity-item {
    display: flex;
    align-items: start;
    gap: 0.75rem;
}

.activity-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.875rem;
}

.activity-content {
    flex: 1;
}
</style>

<script>
function showComingSoon() {
    alert('This feature is coming soon! Advanced team collaboration features will be implemented in a future update.');
}
</script>
{% endblock %}