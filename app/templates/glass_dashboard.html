{% extends "glass_base.html" %}

{% block title %}Dashboard - Glass Task Board{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-grid">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <!-- User Profile Card -->
            <div class="profile-card">
                <div class="match-percentage">77% MATCH</div>

                <div class="profile-header">
                    <img src="https://ui-avatars.com/api/?name={{ current_user.username }}&size=80&background=667eea&color=fff"
                         alt="{{ current_user.username }}"
                         class="profile-avatar">
                    <div class="profile-info">
                        <h2>{{ current_user.username }}</h2>
                        <div class="profile-role">
                            <span>ENVIRONMENTALIST</span>
                            <span class="verified-badge">
                                <i class="bi bi-check"></i>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="profile-section">
                    <h3>About Me</h3>
                    <p>Dedicated to protecting the environment and promoting sustainability through education and advocacy.</p>
                </div>

                <div class="profile-section">
                    <h3>Areas of Expertise</h3>
                    <div class="expertise-tags">
                        <span class="tag tag-conservation">Conservation</span>
                        <span class="tag tag-ecology">Ecology</span>
                        <span class="tag tag-journalism">Journalism</span>
                    </div>
                </div>

                <div class="profile-section">
                    <h3>Languages</h3>
                    <div class="expertise-tags">
                        <span class="tag tag-conservation">English</span>
                    </div>
                </div>

                <div class="profile-section">
                    <h3>Offerings</h3>
                    <div class="offerings-section">
                        <span class="offering-tag">Courses</span>
                        <span class="offering-tag">Videos</span>
                        <span class="offering-tag">Speaking</span>
                    </div>
                </div>

                <div class="profile-section" style="margin-top: 2rem;">
                    <button class="btn btn-primary" style="width: 100%;">
                        <i class="bi bi-envelope"></i> Contact Me
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">Quick Actions</h3>
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <a href="{{ url_for('tasks.create') }}" class="btn btn-glass" style="justify-content: flex-start;">
                        <i class="bi bi-plus-circle"></i> New Task
                    </a>
                    <a href="{{ url_for('main.boards') }}" class="btn btn-glass" style="justify-content: flex-start;">
                        <i class="bi bi-kanban"></i> View Boards
                    </a>
                    {% if current_user.is_admin %}
                    <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-glass" style="justify-content: flex-start;">
                        <i class="bi bi-gear"></i> Admin Panel
                    </a>
                    {% endif %}
                    <button class="btn btn-glass" style="justify-content: flex-start;" data-bs-toggle="modal" data-bs-target="#aiAssistantModal">
                        <i class="bi bi-robot"></i> AI Assistant
                    </button>
                </div>
            </div>

            <!-- Boards Overview -->
            {% if user_boards %}
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">Your Boards</h3>
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    {% for board in user_boards[:4] %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                        <div>
                            <p style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.875rem;">{{ board.name }}</p>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">{{ board.tasks.count() }} tasks</span>
                        </div>
                        <a href="{{ url_for('tasks.list_tasks', board_id=board.id) }}" class="btn btn-glass" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                            <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                    {% endfor %}
                    {% if user_boards|length > 4 %}
                    <div style="text-align: center; margin-top: 0.5rem;">
                        <a href="{{ url_for('main.boards') }}" style="color: var(--primary-color); font-size: 0.875rem; text-decoration: none;">View all boards</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Welcome Header -->
            <div class="glass-card">
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">
                    Welcome back, {{ current_user.username }}! ðŸ‘‹
                </h1>
                <p style="color: var(--text-secondary); font-size: 1.125rem;">
                    Here's what's happening with your tasks today.
                </p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-label">Total Tasks</span>
                    <span class="stat-value">{{ stats.total }}</span>
                    <span class="stat-change">+{{ recent_activity|length }} this week</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Completed</span>
                    <span class="stat-value">{{ stats.completed }}</span>
                    <span class="stat-change">{{ stats.completion_rate }}% rate</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">In Progress</span>
                    <span class="stat-value">{{ tasks_by_status.in_progress|length }}</span>
                    <span class="stat-change">Keep going!</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Active Boards</span>
                    <span class="stat-value">{{ stats.boards }}</span>
                    <span class="stat-change">{{ team_members|length }} teammates</span>
                </div>
            </div>

            <!-- Recent Tasks -->
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.5rem;">Recent Tasks</h2>
                    <a href="{{ url_for('tasks.list_tasks') }}" class="btn btn-glass">
                        View All <i class="bi bi-arrow-right"></i>
                    </a>
                </div>

                {% if recent_tasks %}
                    {% for task in recent_tasks %}
                    <div class="task-card">
                        <div class="task-priority priority-{{ task.priority }}"></div>
                        <h3 class="task-title">{{ task.title }}</h3>
                        <p class="task-description">{{ task.description or 'No description provided' }}</p>
                        <div class="task-meta">
                            <div class="task-date">
                                <i class="bi bi-calendar3"></i>
                                {% if task.due_date %}
                                    {{ task.due_date.strftime('%b %d, %Y') }}
                                {% else %}
                                    No due date
                                {% endif %}
                            </div>
                            <div class="task-assignee">
                                <img src="https://ui-avatars.com/api/?name={{ task.user.username }}&size=24&background=667eea&color=fff"
                                     alt="{{ task.user.username }}"
                                     class="assignee-avatar">
                                <span>{{ task.board.name if task.board else 'No board' }}</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; padding: 3rem;">
                        <i class="bi bi-check2-circle" style="font-size: 3rem; color: var(--text-muted);"></i>
                        <p style="color: var(--text-secondary); margin-top: 1rem;">No tasks yet. Create your first task!</p>
                        <a href="{{ url_for('tasks.create') }}" class="btn btn-primary" style="margin-top: 1rem;">
                            <i class="bi bi-plus-circle"></i> Create Task
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <!-- Activity Feed -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">
                    <i class="bi bi-activity"></i> Recent Activity
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% if recent_activity %}
                        {% for task in recent_activity %}
                        <div style="display: flex; gap: 0.75rem; align-items: start;">
                            <div style="width: 8px; height: 8px; background: var(--primary-color); border-radius: 50%; margin-top: 0.5rem;"></div>
                            <div style="flex: 1;">
                                <p style="font-size: 0.875rem; color: var(--text-primary); margin-bottom: 0.25rem;">
                                    {{ task.title }}
                                </p>
                                <span style="font-size: 0.75rem; color: var(--text-muted);">
                                    {{ task.updated_at.strftime('%b %d, %H:%M') }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--text-muted); font-size: 0.875rem;">No recent activity</p>
                    {% endif %}
                </div>
            </div>

            <!-- Upcoming Deadlines -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">
                    <i class="bi bi-clock"></i> Upcoming Deadlines
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% if upcoming_tasks %}
                        {% for task in upcoming_tasks %}
                        <div style="padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                            <p style="font-weight: 500; margin-bottom: 0.25rem;">{{ task.title }}</p>
                            <span style="font-size: 0.875rem; color: var(--accent-color);">
                                <i class="bi bi-calendar-event"></i>
                                {{ task.due_date.strftime('%b %d, %Y') }}
                            </span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--text-muted); font-size: 0.875rem;">No upcoming deadlines</p>
                    {% endif %}
                </div>
            </div>

            <!-- Team Members -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">
                    <i class="bi bi-people"></i> Team Members
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% if team_members %}
                        {% for member in team_members %}
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <img src="https://ui-avatars.com/api/?name={{ member.username }}&size=32&background=667eea&color=fff"
                                 alt="{{ member.username }}"
                                 style="width: 32px; height: 32px; border-radius: 50%;">
                            <div style="flex: 1;">
                                <p style="font-weight: 500; font-size: 0.875rem;">{{ member.username }}</p>
                                <span style="font-size: 0.75rem; color: var(--text-muted);">
                                    {% if member.is_admin %}Admin{% else %}Member{% endif %}
                                </span>
                            </div>
                            <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--text-muted); font-size: 0.875rem;">No team members yet</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Additional Dashboard Styles */
    .dashboard-container {
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .task-card {
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .task-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        transition: left 0.5s ease;
    }

    .task-card:hover::before {
        left: 100%;
    }

    .stat-card {
        position: relative;
        overflow: hidden;
    }

    .stat-card::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
        animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
            opacity: 0.5;
        }
        50% {
            transform: scale(1.1);
            opacity: 0.3;
        }
    }
</style>

<!-- AI Assistant Modal -->
<div class="modal fade" id="aiAssistantModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: var(--glass-bg); border: 1px solid var(--glass-border); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);">
            <div class="modal-header" style="border-bottom: 1px solid var(--glass-border);">
                <h5 class="modal-title">
                    <i class="bi bi-robot text-primary"></i> AI Task Assistant
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 2rem;">
                    <i class="bi bi-robot" style="font-size: 3rem; color: var(--primary-color);"></i>
                    <h6 style="margin-top: 1rem;">AI Assistant Coming Soon!</h6>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">Get intelligent task suggestions, priority recommendations, and productivity insights.</p>
                    <div class="expertise-tags" style="margin-top: 1rem;">
                        <span class="tag tag-conservation">Smart Suggestions</span>
                        <span class="tag tag-ecology">Auto-Priority</span>
                        <span class="tag tag-journalism">Insights</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add overdue tasks alert if needed -->
{% if overdue_tasks %}
<div style="position: fixed; top: 100px; right: 20px; z-index: 1050;">
    <div class="glass-card" style="border: 2px solid var(--accent-color); background: rgba(245, 101, 101, 0.1);">
        <h6 style="color: var(--accent-color); margin-bottom: 0.75rem;">
            <i class="bi bi-exclamation-triangle"></i> {{ overdue_tasks|length }} Overdue Task{{ 's' if overdue_tasks|length != 1 else '' }}
        </h6>
        {% for task in overdue_tasks[:2] %}
        <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">{{ task.title }}</div>
        {% endfor %}
        {% if overdue_tasks|length > 2 %}
        <small style="color: var(--text-muted);">+{{ overdue_tasks|length - 2 }} more</small>
        {% endif %}
    </div>
</div>
{% endif %}

{% endblock %}