{% extends "glass_base.html" %}

{% block title %}Reports - TaskFlow{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Reports Header -->
    <div class="glass-card mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">
                    <i class="bi bi-graph-up text-primary"></i> Reports & Analytics
                </h1>
                <p style="color: var(--text-secondary); font-size: 1.125rem;">
                    Track your productivity and project insights
                </p>
            </div>
            <div>
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-glass">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="glass-card text-center">
                <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);">
                    {{ stats.total_tasks }}
                </div>
                <small class="text-muted">Total Tasks</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="glass-card text-center">
                <div style="font-size: 2rem; font-weight: 700; color: var(--secondary-color);">
                    {{ stats.completed_tasks }}
                </div>
                <small class="text-muted">Completed</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="glass-card text-center">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-color);">
                    {{ stats.in_progress_tasks }}
                </div>
                <small class="text-muted">In Progress</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="glass-card text-center">
                <div style="font-size: 2rem; font-weight: 700; color: var(--text-primary);">
                    {{ stats.total_boards }}
                </div>
                <small class="text-muted">Active Boards</small>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Productivity Chart -->
            <div class="glass-card mb-4">
                <h3 class="mb-3">
                    <i class="bi bi-bar-chart"></i> Productivity Overview
                </h3>
                <div class="text-center py-5">
                    <i class="bi bi-graph-up" style="font-size: 4rem; color: var(--text-muted);"></i>
                    <h5 class="mt-3">Interactive Charts Coming Soon</h5>
                    <p class="text-muted">
                        Detailed productivity charts and analytics will be available in the next update.
                    </p>
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="text-center">
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color);">
                                    {% if stats.total_tasks > 0 %}
                                        {{ "%.1f"|format((stats.completed_tasks / stats.total_tasks) * 100) }}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </div>
                                <small class="text-muted">Completion Rate</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--secondary-color);">
                                    {{ stats.pending_tasks }}
                                </div>
                                <small class="text-muted">Pending Tasks</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--accent-color);">
                                    {{ user_boards|length }}
                                </div>
                                <small class="text-muted">Active Boards</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Board Performance -->
            <div class="glass-card">
                <h3 class="mb-3">
                    <i class="bi bi-kanban"></i> Board Performance
                </h3>
                {% if user_boards %}
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Board Name</th>
                                    <th>Total Tasks</th>
                                    <th>Completed</th>
                                    <th>Progress</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for board in user_boards %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-kanban me-2"></i>
                                            {{ board.name }}
                                        </div>
                                    </td>
                                    <td>{{ board.tasks.count() }}</td>
                                    <td>{{ board.tasks.filter_by(status='completed').count() }}</td>
                                    <td>
                                        {% set total = board.tasks.count() %}
                                        {% set completed = board.tasks.filter_by(status='completed').count() %}
                                        {% set progress = (completed / total * 100) if total > 0 else 0 %}
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-primary" style="width: {{ progress }}%"></div>
                                        </div>
                                        <small class="text-muted">{{ "%.0f"|format(progress) }}%</small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-kanban" style="font-size: 2rem; color: var(--text-muted);"></i>
                        <p class="text-muted mt-2">No boards to analyze</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Export Options -->
            <div class="glass-card mb-4">
                <h3 class="mb-3">
                    <i class="bi bi-download"></i> Export Data
                </h3>
                <div class="d-flex flex-column gap-2">
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-file-pdf"></i> Export as PDF
                    </button>
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-file-excel"></i> Export as Excel
                    </button>
                    <button class="btn btn-glass" onclick="showComingSoon()">
                        <i class="bi bi-file-text"></i> Export as CSV
                    </button>
                </div>
            </div>

            <!-- Quick Insights -->
            <div class="glass-card">
                <h3 class="mb-3">
                    <i class="bi bi-lightbulb"></i> Quick Insights
                </h3>
                <div class="insight-item mb-3">
                    <h6 style="color: var(--primary-color);">
                        <i class="bi bi-check-circle"></i> Productivity Tip
                    </h6>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">
                        {% if stats.completed_tasks > 0 %}
                            Great work! You've completed {{ stats.completed_tasks }} tasks.
                            Keep up the momentum!
                        {% else %}
                            Start completing tasks to see your productivity insights here.
                        {% endif %}
                    </p>
                </div>

                {% if stats.pending_tasks > 5 %}
                <div class="insight-item mb-3">
                    <h6 style="color: var(--accent-color);">
                        <i class="bi bi-exclamation-triangle"></i> Action Needed
                    </h6>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">
                        You have {{ stats.pending_tasks }} pending tasks.
                        Consider prioritizing them to improve workflow.
                    </p>
                </div>
                {% endif %}

                <div class="insight-item">
                    <h6 style="color: var(--secondary-color);">
                        <i class="bi bi-graph-up"></i> Growth
                    </h6>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">
                        You're managing {{ stats.total_boards }} board{{ 's' if stats.total_boards != 1 else '' }}.
                        Great organization skills!
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.insight-item {
    padding: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    border-left: 3px solid var(--primary-color);
}

.progress {
    background-color: rgba(255, 255, 255, 0.1);
}
</style>

<script>
function showComingSoon() {
    alert('This feature is coming soon! Advanced reporting features will be implemented in a future update.');
}
</script>
{% endblock %}